<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><link rel="mask-icon" href="/images/logo.svg" color=""><link rel="manifest" href="/images/manifest.json"><meta name="msapplication-config" content="/images/browserconfig.xml"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="峻峻尼的个人博客" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="峻峻尼的个人博客" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="峻峻尼的个人博客" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="http://example.com/2023/01/24/2022.12.16/"><title>HCIP(二十三) 2022.12.16 | Z.J.J = 峻峻尼的个人博客</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">HCIP(二十三) 2022.12.16</h1><div class="meta"><span class="item" title="创建时间：2023-01-24 12:30:55"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-01-24T12:30:55+08:00">2023-01-24</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>7.3k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>7 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Z.J.J</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipevo9j1jj20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicljitigmj20zk0m87fp.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipevarprfj20zk0m8npd.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipet8c1a2j20zk0m8kct.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclflwv2aj20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipeun65urj20zk0m81ii.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/2023/01/24/2022.12.16/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="峻峻尼"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="峻峻尼的个人博客"></span><div class="body md" itemprop="articleBody"><h4 id="mpls-vpn"><a class="markdownIt-Anchor" href="#mpls-vpn">#</a> MPLS VPN :</h4><p>​	VPN：</p><p>虚拟专用网络</p><h5 id="背景"><a class="markdownIt-Anchor" href="#背景">#</a> 背景：</h5><pre><code>1. 直接通过公网通信安全性过低
2. 搭建物理专线安全性高，但是成本也相应增多
</code></pre><p>PE：运营商边缘设备</p><p>P：运营商核心设备</p><p>CE：用户边缘设备</p><h5 id="vpf"><a class="markdownIt-Anchor" href="#vpf">#</a> VPF:</h5><p>虚拟路由转发，类似虚拟路由表，用于 PE 本地区分不同客户的路由（不同客户可能存在地址空间重叠的问题），只在本地有效</p><h5 id="rd"><a class="markdownIt-Anchor" href="#rd">#</a> RD：</h5><p>路由标识符，8 字节，用于 PE 之间传递路由时进行区分，普通的 IPv4 路由加上 RD 值后就是 VPN-IPv4 路由，简称 VPNv4 路由，长 12 字节</p><h5 id="rt"><a class="markdownIt-Anchor" href="#rt">#</a> RT:</h5><p>分为 Export-RT 和 Import-RT（出方向 RT 和入方向 RT），出方向 RT 值作为 MP-BGP 的扩展团体属性携带在路由中，入方向 RT 值用于检查收到的路由是否可以接收</p><p><strong>注：MP-BGP：BGP 的多协议扩展，普通的 BGP-4 无法传递 VPNv4 路由，需要使能地址族 VPNv4 功能，也就是 MP-BGP，使其能够传递 VPNv4 路由</strong></p><h5 id="vpn的路由传递"><a class="markdownIt-Anchor" href="#vpn的路由传递">#</a> VPN 的路由传递：</h5><pre><code>1. 本端CE——&gt;本端PE: 通过路由协议
2. 本端PE——&gt;对端PE：通过MP-BGP
3. 对端PE——&gt;对端CE：同上
</code></pre><h5 id="vpn的报文转发"><a class="markdownIt-Anchor" href="#vpn的报文转发">#</a> VPN 的报文转发：</h5><pre><code>1. 数据从PE设备转发至P设备时，P设备没有路由无法转发，需要在公网设置LDP隧道，分配公网标签
2. 数据从PE1-PE2时，PE无法判断查找那个路由表，需要MP-BGP 为私网路由分配私网标签进行区分
</code></pre><p><img data-src="C:%5CUsers%5Cz.j.j%5CDesktop%5Chcip%E5%9F%B9%E8%AE%AD%5Cassets%5C1671180735844.png" alt="1671180735844"></p><p>VPN 路由的传递过程：</p><p>CE1——PE1——P——PE2——CE2</p><ol><li>CE1-PE1 之间运行了路由协议，并且 PE1 运行协议时绑定了 VPN 实例，所以 CE1 的路由可以传递到 PE1 的 VRF 中</li><li>PE1 与 PE2 之间建立了 MP-BGP 的 IBGP 对等体关系，将 CE1-PE1 之间的路由协议引入 BGP 中，PE2 就可以学习到 CE1 的路由，并且携带了出方向的 RT 值（作为 BGP 的扩展团体属性），MP-BGP 为该路由分配了一个私网标签（发布给 PE2 作为出标签）</li><li>PE2-CE2 之间也运行了路由协议，将 BGP 引入 PE2-CE2 路由协议中，CE2 就可以学习到 CE1 的路由</li></ol><p>数据转发过程：</p><p>CE2———&gt;CE1</p><ol><li>CE2 想要访问 CE1, 封装数据查找 FIB，下一跳为 PE2, 将数据发送给 PE2</li><li>PE2 收到数据后通过查找 CE2 对应的 VRF 转发表，发现去往 CE2 需要进行标签转发，加上一个私网标签，然后去往 CE1 的下一跳为 PE1, 非直连，再查找去往 PE1 的转发表，发现又需要进行标签转发，加上一层公网标签，从对应的接口发送给下一跳设备（P 设备）</li><li>P 设备收到数据后，看到最外层的公网标签，根据入标签找到对应的出标签，执行交换标签的动作（公网标签），从对应的接口发送给下一跳</li><li>PE1 收到数据后，外层公网标签没有对应的出标签，拆掉公网标签，查看内层私网标签，发现是给 CE1 路由分配的，没有对应的出标签，拆掉私网标签，查找 CE1 对应的 VRF1 转发表，发送给 CE1 设备</li></ol><h4 id="vpn组网"><a class="markdownIt-Anchor" href="#vpn组网">#</a> VPN 组网：</h4><p>​	Intranet：相同 VPN 用户之间互访，不同 VPN 用户相互隔离</p><p>​	Extranet：一个 VPN 用户可以与不同 VPN 用户互访</p><p>​	Hub-Spoke：Spoke 之间访问需要通过 Hub（例如分公司之间通信经过总公司）</p><p>CE1(AS100)——PE1—P—PE2(AS 123)——CE2(AS 100)</p><p>CE1 和 CE2 属于同一个 VPN 用户，AS 号相同，当 PE-CE 之间运行的都是 BGP 协议时，PE 将路由传递给 CE 设备，会由于 AS_Path 中包含自身 AS 号不接收 VPN 路由，导致路由传递失败</p><p>注：开启 PE 设备上针对对等体的 AS 号替换功能，将其中的 AS 号替换为本地 AS 号（原本 PE 传递的路由 AS_Path 为 123，100；替换后为 123，123）</p><p>So0 属性：</p><p>​	开启 PE 设备的 AS 号替换功能后，在一些特殊场景下可能会导致路由环路（一个 PE 连接了同一个站点的多个 CE, 并且都建立 EBGP）, 此时可以设置 PE 针对这两个 CE 的相同 So0 值，当 PE 从 CE1 学习到路由后，给路由加上设置的 So0 属性，再传递给另一个 CE 时检查路由携带的 So0 属性与要传递 CE 设置的 So0 属性是否一致，一致则不传递</p><p>DomainID，Route Type ：通过 BGP 的扩展团体属性携带，两端 CE-PE 都运行 OSPF 时，如果接收到的路由 DomianID 与本地一致，表示属于同一个 OSPF 域，原本的 Route Type 为 1，2，3——3 ，原本 5，7—5，7；如果 DomianID 不一致，原本 1，2，3，5，7——5，7</p><p>Type-3 防环：PE 将路由传递给 OSPF 实例邻居时，将 LSA 中 Option 的 DN 为置位 1，其他 PE 设备收到 DN 置位 1 的路由不进行计算</p><p>Type-5/7 防环：PE 在将路由传递给 OSPF 实例邻居时 LSA 中携带 Route Tag（默认为本地 AS 计算得出）, 其他 PE 收到 Route Tag 数值与本地计算得出的一致则不进行计算</p><p>后门链路：在两端 CE 之间建立后门链路作为 VPN 备份，互相传递路由，如果 CE-PE 协议为 OSPF , 导致后门链路传递的路由为 OSPF 域内路由，VPN 传递的为域间路由（type3），后门链路会被优选，没有达到作为备份的目的</p><p>Sham Link：在 PE 设备之间建立一条伪链路，使 VPN 传递的路由也成为 OSPF 域内，再将后门链路的开销设置比 Sham link 大，则可以使后门链路成为备份链路</p><p>ISIS 快速收敛；</p><p>​	I-SPF; 增量最短路劲优先算法，只计算发送变化的节点信息</p><p>​	ISIS 的分片扩展，正常情况下，一个 ISIS 路由器的 LSP 可以最多生成 256 个分片携带信息，可以携带的数据有限</p><p>​	分片扩展，一个 ISIS 设备可以设置多个虚拟路由器（最多 50 个），每一个虚拟路由器可以产生自己的 LSP（可以携带 256 个分片），所以扩展后可携带分片数为 50*256 个</p><p>​	初始系统，物理路由器</p><p>​	系统 ID，物理路由器的系统 ID</p><p>​	虚拟系统，虚拟路由器</p><p>​	附加系统 ID，虚拟路由器的系统 ID</p><p>​	分配扩展模式，</p><p>​	Mode-1，邻居路由器不支持分片扩展，将虚拟系统作为真实设备和原设备分开进行计算</p><p>​	Mode-2，邻居路由器支持分片扩展，能够得知虚拟系统的初始系统是原设备，将数据集中统一计算</p><p>BGP 高级特性，</p><p>​	路由控制，</p><p>​	正则表达式，（特殊字符含义）</p><p>​	AS-path Filter，路劲信息过滤器，针对 BGP 路由中携带了 AS_Path 属性对路由进行控制，AS_PATH Filter 可以通过正则表达式匹配路由 AS_Path 字符串）</p><p>例如 10.1.1.1/32 携带 AS_Path 103 102 101</p><p>​	通过 AS_Path Filter 匹配时，</p><p>​	IP AS_Path Filter 1 permit /deny ^103/101$ 等</p><p>注 AS_Path Filter 可以直接针对对等体应用，也可以结合 ROuter-POlicy 使用</p><p>​	Community Filter，团体属性过滤器，针对 BGP 路由中携带的团体属性进行控制</p><p>​	分类，</p><p>​	基本 Community Filter ，编号 1-99，可以匹配路由中的团体号 / 公认团体属性（传递范围）</p><p>​	高级 Community Filter， 编号 100-199，可以通过正则表达式对路由的团体属性进行匹配</p><p>​	注 BGP 路由器默认不向对等体通过团体属性，可以通过 Peer 对等体 IP Advertise-Community 命令开启</p><p>结合 ROute-policy 使用</p><p>BGP 其他特性，</p><p>​	ORF，出口路由过滤器，BGP 设备只期望接收对等体发送自己某些路由，可以配置策略，然后通过 ORF 报文发送给对等体，对等体接收到 ORF 报文后策略只发布满足条件的路由</p><p>​	对等体组，将某些具有相同特性的对等体放入同一个对等体组，然后通过对对等体配置相关参数生效于对等体组内的对等体设备</p><p>​	分为 External 和 Internal ，External 表示 EBGP 对等体组，Internal 表示 IBGP 对等体组</p><p>​	例如，group 1 External // 创建 EBGP 对等体组 1</p><p>​	group 2 Internal // 创建 IBGP 对等体组 2</p><p>​	peer 对等体 group 1 // 加入组 1 为 EBGP 对等体</p><p>​	Peer 对等体 group 2 // 加入组 2 为 IBGP 对等体</p><p>注 由于 IBGP 对等体组 AS 号与本地相同，所以对等体 AS 号直接生成，EBGP 对等体 AS 号未知，需要指定 AS 号，peer 1 as-number * //1 为 EBGP 对等体组号</p><p>peer 2 connect loopback 0 // 与对等体组 2 的所有设备用环回口建立关系、</p><p>BGP 安全性，</p><pre><code>1. 防止建立非法BGP对等体关系，bgp认证
2. 防止设备发送大量非法BGP报文占用CPU,GTSM
</code></pre><p>GTSM，通过 TTL 安全保护机制，通过设置与合法设备交互 BGP 报文的有效条数，决定收到的合法 BGP 报文的 TTL，如果收到的 BGP 报文在有效跳数内，正常接收，否则丢弃</p><p>公式 ，TTL=(255-HOPS+1,255),HOPS 为设置的有效跳数</p><p>路由反射器组网，</p><p>​	备份 RR 组我，多个 RR 指定相同的 BGP 路由器作为自己的客户端，并且 RR 多设置相同的集群 ID</p><p>​	多集群同级 RR 组网，所有路由器只作为 RR 身份</p><p>​	多集群分级 RR 组网，路由器不仅作为 RR，还作为其他 RR 的客户端（只为 RR 为一级 RR, 作为一级 RR 的客户端身份的 RR 为二级 RR…）</p><p><img data-src="C:%5CUsers%5Cz.j.j%5CDesktop%5Chcip%E5%9F%B9%E8%AE%AD%5Cassets%5C1671610768740.png" alt="1671610768740"></p><h4 id="vlan聚合"><a class="markdownIt-Anchor" href="#vlan聚合">#</a> VLAN 聚合：</h4><p>传统 VLAN 划分如果想要实现 VLAN 间通信需要为每一个 VLAN 设置 VLANIF 逻辑接口，并为其设置 IP 地址，并且每一个 VLAN 都属于不同子网，会造成 IP 地址的浪费（一个 VLAN 至少有三个 IP 地址不能使用，VLANIF 地址，子网段网络地址和广播地址），通过 VLAN 聚合技术减少 IP 地址的浪费</p><h5 id="super-vlan"><a class="markdownIt-Anchor" href="#super-vlan">#</a> Super VLAN ：</h5><p>聚合 VLAN，只包含三层 VLANIF 逻辑接口，作为所有 Sub VLAN 内 PC 的网关，Sub VLAN 间通信通过 SuperVLAN</p><h5 id="sub-vlan"><a class="markdownIt-Anchor" href="#sub-vlan">#</a> Sub VLAN：</h5><p>子 VLAN , 只包含二层物理接口，实现二层广播域的划分，相同 SubVLAN 内二层互通，不同 SubVLAN 二层互相隔离</p><p><strong>注：一个 SuperVLAN 可以设置多个 SubVLAN，一个 SubVLAN 只能绑定一个 SuperVLAN，一个 SuperVlan 下的所有 SubVlan 属于同一个网段</strong></p><p>不同 SubVLAN 间通信：由于目的地与自身处于相同网段，所以直接发送 ARP 广播请求报文，SuperVLAN 也能收到，开启 SuperVLAN 的 SubVLAN 间代理功能后，SuperVLAN 会将收到的广播 ARP 会发送给所有的 SubVLAN，目的设备也能收到，收到后回复 ARP 响应，至此达到通信的目的</p><p>Subvlan 内设备与其他 VLAN（不属于 SubVLAN）设备二层通信：正常发送数据，由于 SuperVLAN 不包含物理接口，所以数据所携带的标签不会发生变化，可与其他相同 VLANTag 的 PC 直接通信</p><p>二层通信：通过 SuperVLAN 进行三层路由互通</p><p><img data-src="C:%5CUsers%5Cz.j.j%5CDesktop%5Chcip%E5%9F%B9%E8%AE%AD%5Cassets%5C1671677451957.png" alt="1671677451957"></p><h5 id="mux-vlan"><a class="markdownIt-Anchor" href="#mux-vlan">#</a> Mux VLAN：</h5><p>分为主 VLAN，从 VLAN，主 Vlan 唯一并且可以与所有从 VLAN 通信，从 VLAN 分为互通型从 VLAN 和隔离型从 VLAN</p><p>​	<strong>主 VLAN</strong>：PrincipalVLAN, 在一个 MuxVLAN 中只会有一个，并且主 VLAN 下的设备可以与 Muxvlan 内所有设备互通</p><p>​	<strong>互通型从 VLAN</strong>：GroupVLAN, 属于相同 VLAN 的设备之间能够互通，不同互通 VLAN 之间互相隔离，也不能与隔离 vlan 通信，可以与主 VLAN 通信</p><p>​	<strong>隔离型从 VLAN</strong>：SeparateVLAN, 属于隔离 VLAN 的设备不能与相同 VLAN 内 / 互通 VLAN 通信，只能与主 VLAN 通信（一个 MuxVLAN 只能有一个隔离型从 VLAN）</p><p><img data-src="C:%5CUsers%5Cz.j.j%5CDesktop%5Chcip%E5%9F%B9%E8%AE%AD%5Cassets%5C1671679308345.png" alt="1671679308345"></p><h5 id="qinq"><a class="markdownIt-Anchor" href="#qinq">#</a> QinQ:</h5><p>802.1Q in 802.1Q，传统的 VLAN 数据帧只能携带一层 VLAN Tag，最多存在 4096 个 VLAN（0-4095，可用 4094 个），vlan 资源有限，为了扩展 VLAN 空间，通过 QinQ 的技术，在原有基础上增加一层 TAG，外层为公网 Tag，内存为私网 Tag，最多可存在 4096*4096 个 VLAN (可用 4094 * 4904)</p><h6 id="数据转发"><a class="markdownIt-Anchor" href="#数据转发">#</a> 数据转发：</h6><p>私网内部通过私网 Tag 正常转发，在进入公网时加上一层所属的公网 Tag，通过外层公网 Tag 在公网进行转发，进入私网时将外层公网 Tag 剥离，再通过内层私网 TAG 转发至目标设备</p><h6 id="分类"><a class="markdownIt-Anchor" href="#分类">#</a> 分类：</h6><p>​	基本 QinQ：为一个私网局域网设置一个公网 Tag，无论内网的哪一个 VLAN 数据进入公网都加上统一的公网 tag</p><p>​	灵活 QinQ：可以为内网不同的 vlan 设置不同的公网 Tag，内网数据进入公网时，根据设置的策略加上对应的公网 tag</p><p><img data-src="C:%5CUsers%5Cz.j.j%5CDesktop%5Chcip%E5%9F%B9%E8%AE%AD%5Cassets%5C1671693084166.png" alt="1671693084166"></p><p><img data-src="C:%5CUsers%5Cz.j.j%5CDesktop%5Chcip%E5%9F%B9%E8%AE%AD%5Cassets%5C1671694832837.png" alt="1671694832837"></p><p>端口隔离，可以将设备的端口加入端口隔离组，处于相同隔离组的端口所连接的终端无法通信</p><p>背景，想要实现终端之间二层隔离，通常会将端口划分为不同 VLAN，但是会浪费有限的 Vlan 资源，通过端口隔离技术，既能够实现报文二层隔离，又能够节约 VLAN 资源</p><p>隔离类型，</p><p>​	双向隔离，端口加入同一个隔离组后，互相不能通信</p><p>​	单向隔离，在接口视图下，指定该端口与另一个端口之间的单向隔离，该接口不能与指定的端口通信，但是对端可以将数据发送给本端口</p><p>隔离模式，</p><p>​	L2，二层隔离三层互通（缺省），需要开启 VlanIF 的 vlan 内 ARP 代理功能，实现处于相同隔离组的端口三层通信</p><p>​	ALL，二层三层都隔离，处于同一个隔离组的端口之间彻底隔离无法通信</p><p><img data-src="C:%5CUsers%5Cz.j.j%5CDesktop%5Chcip%E5%9F%B9%E8%AE%AD%5Cassets%5C1672711912633.png" alt="1672711912633"></p><p>MAC 地址表安全，</p><p>​	动态 MAC 地址表项，交换机动态学习报文的源 MAC 所形成的 MAC 地址表项</p><p>​	静态 MAC 地址表项，手工配置 MAC 地址与端口的映射关系所形成的表项，优先级高于动态表项</p><p>​	黑洞 MAC 地址表项，配置为黑洞 MAC 的 MAC 地址类型于加入黑名单，交换机接收到源 MAC / 目的 MAC 为黑洞 MAC 的报文直接丢弃</p><p>​	MAC 地址表项老化时间，默认 300 是，可以修改，0 为不老化，可以修改（防止 MAC 地址表项爆炸式增长）</p><p>​	禁止 MAC 地址学习功能，默认交换机的 MAC 地址学习功能已使能，可以关闭，关闭后交换机不再形成该端口对应报文的源 MAC 表项（收到报文的动作默认转发，可以设置为丢弃）</p><p>​	限制 MAC 地址表项学习数量，可以设置交换机端口学习 MAC 地址的最大数量，超过数量的可以丢弃报文（修改动作，默认转发）/ 告警</p><p><img data-src="C:%5CUsers%5Cz.j.j%5CDesktop%5Chcip%E5%9F%B9%E8%AE%AD%5Cassets%5C1672717033943.png" alt="1672717033943"></p><p>端口安全，</p><p>​	安全动态 MAC 地址，开启端口安全后动态学习的 MAC 地址，</p><p>​	特点，默认不会老化，可以设置老化时间，设备重启会丢失</p><p>​	使用场景，适用于存在大量不固定终端的场景</p><p>​	安全静态 MAC 地址，开启端口安全后手工配置 MAC 地址表项</p><p>​	特点，不会被老化，保存配置后重启不会丢失</p><p>​	使用场景，存在少量固定终端</p><p>​	Sticky MAC 地址，粘贴 MAC 地址，开启了端口安全的同时使能了 Sticky MAC 功能后转换的地址（动态学习 / 手工添加）</p><p>​	特点，不会被老化，保存配置后重启不会丢失</p><p>​	适用场景，存在大量固定终端</p><p>​	限制 MAC 地址学习数量，开启端口安全，默认端口学习 MAC 地址数量为 1，超出数量的采取安全保护动作</p><p>​	安全保护动作，</p><p>​	protect，丢弃源 MAC 不存在的报文</p><p>​	（缺省）restrict，丢弃源 MAC 不存在的报文并告警</p><p>​	shutdown，端口被设置为 error-down，并告警</p><p><img data-src="C:%5CUsers%5Cz.j.j%5CDesktop%5Chcip%E5%9F%B9%E8%AE%AD%5Cassets%5C1672731713406.png" alt="1672731713406"></p><p>MAC 地址漂移防止与检测，</p><p>​	防止低优先级端口覆盖高优先级端口，修改端口的 mac 地址学习优先级，默认为 0，优先级高的端口可以覆盖优先级低的，低优先级不能覆盖高优先级</p><p>​	配置不允许相同优先级端口发送漂移，默认可以发生，undo 后可以防止</p><p>​	基于 Vlan 检测 mac 地址漂移，发生漂移后可执行动作告警 / 关闭端口 / 阻断 MAC 地址</p><p>​	基于全局检测 mac 地址漂移，发生漂移后可执行动作告警 / 关闭端口 / 退出 VLAN</p><p><img data-src="C:%5CUsers%5Cz.j.j%5CDesktop%5Chcip%E5%9F%B9%E8%AE%AD%5Cassets%5C1672736115087.png" alt="1672736115087"></p><p>MACsec，保证二层数据传输的可靠性，具有数据完整性检查，数据加密，真实性校验等机制保障数据传输的安全性</p><p>CAK，安全连接关联密钥，为点到点两端预相同配置连接密钥</p><p>KEY Server，通过预配置参数选举，决定加密方案（生成数据加密密钥）（key server 是通过 MKA，MACsec 数据加密协商协议选举）</p><p>SAK，key Server 生成的数据密钥，用于真实数据传输时进行加密（安全关联密钥）</p><p>流量抑制，</p><p>​	入方向，针对接收的数据设置相关 阈值（广播 / 组播 / 单播）从而控制数据的发送速率（超过阈值部分丢弃，阈值内可以通过）</p><p>​	出方向，阻断广播 / 组播 / 单播报文</p><p>广播风暴，在数据入反向对数据进行控制，设置相关阈值，在阈值范围内的数据可以通过，不在范围内的数据完全丢弃并设置相关惩罚动作（阻断报文 / 关闭端口），阻断不在范围内的报文只有超过阈值的报文不能通过，关闭端口后所有报文都不能通过）</p><p>DHCP Snooping，防止针对 DHCP 漏洞攻击，通过信任功能，绑定表等实现</p><p>攻击手段，</p><p>​	DHCP 饿死攻击，非法设备通过伪造 DHCP 客户端请求报文的源 MAC 地址，不断向服务器请求 IP 地址等网络参数，直至耗尽服务器的地址，导致合法客户端没有地址可以（饿死）</p><p>​	解决，设置交换机端口学习 MAC 地址的数量，防止非法设备修改 MAC 地址</p><p>​	改变 CHADDR 字段的 Dos 攻击，非法设备通过修改 DHCP 报文中的 CHADDR 字段（源 MAC 不变）不停的向服务器请求 IP 地址（DHCP 服务器通过 CHADDR 字段分配地址），直至耗尽地址池的地址，当合法设备需要地址时服务器没有地址可分配（拒绝服务）</p><p>​	解决，交换机 DHCP Snooping 可以检查收到的 DHCP 报文中 CHADDR 字段是否与源 MAC 一致，一致则正常处理，不一致则丢弃报文（防止修改 CHADDR 字段）</p><p>​	DHCP 中间人攻击，非法设备利用 ARP 致使客户端和服务器学习到错误的 ARP 映射关系（对于客户端，服务器 IP - 非发设备 MAC，对于服务器，客户端 IP - 非法设备 MAC），客户端和服务器之间交互的所有报文都经过非法设备转发，可能会造成信息泄露 / 信息被篡改等安全隐患</p><p>​	解决，交换机可以形成 DHCP Snooping 绑定表，表中记录了正确的客户端和服务器信息（IP 地址，MAC 地址，vlan，接口等对应关系），当交换机收到 DHCP 报文时，可以对报文以及接收到的接口信息与绑定表做对比，信息一致才能正常处理，否则丢弃报文</p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-01-04 11:29:59" itemprop="dateModified" datetime="2023-01-04T11:29:59+08:00">2023-01-04</time> </span><span id="2023/01/24/2022.12.16/" class="item leancloud_visitors" data-flag-title="HCIP(二十三) 2022.12.16" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="峻峻尼 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="峻峻尼 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="峻峻尼 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>峻峻尼 <i class="ic i-at"><em>@</em></i>峻峻尼的个人博客</li><li class="link"><strong>本文链接：</strong> <a href="http://example.com/2023/01/24/2022.12.16/" title="HCIP(二十三) 2022.12.16">http://example.com/2023/01/24/2022.12.16/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2023/01/24/2022.12.15/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipexoj0moj20zk0m8kgu.jpg" title="HCIP(二十二) 2022.12.15"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>HCIP(二十二) 2022.12.15</h3></a></div><div class="item right"><a href="/2023/01/24/2022.12.8/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeyonbf9j20zk0m8e81.jpg" title="HCIP(十七） 2022.12.8"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>HCIP(十七） 2022.12.8</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#mpls-vpn"><span class="toc-number">1.</span> <span class="toc-text">MPLS VPN :</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.1.</span> <span class="toc-text">背景：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#vpf"><span class="toc-number">1.2.</span> <span class="toc-text">VPF:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rd"><span class="toc-number">1.3.</span> <span class="toc-text">RD：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#rt"><span class="toc-number">1.4.</span> <span class="toc-text">RT:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#vpn%E7%9A%84%E8%B7%AF%E7%94%B1%E4%BC%A0%E9%80%92"><span class="toc-number">1.5.</span> <span class="toc-text">VPN 的路由传递：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#vpn%E7%9A%84%E6%8A%A5%E6%96%87%E8%BD%AC%E5%8F%91"><span class="toc-number">1.6.</span> <span class="toc-text">VPN 的报文转发：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vpn%E7%BB%84%E7%BD%91"><span class="toc-number">2.</span> <span class="toc-text">VPN 组网：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vlan%E8%81%9A%E5%90%88"><span class="toc-number">3.</span> <span class="toc-text">VLAN 聚合：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#super-vlan"><span class="toc-number">3.1.</span> <span class="toc-text">Super VLAN ：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#sub-vlan"><span class="toc-number">3.2.</span> <span class="toc-text">Sub VLAN：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mux-vlan"><span class="toc-number">3.3.</span> <span class="toc-text">Mux VLAN：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#qinq"><span class="toc-number">3.4.</span> <span class="toc-text">QinQ:</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BD%AC%E5%8F%91"><span class="toc-number">3.4.1.</span> <span class="toc-text">数据转发：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">3.4.2.</span> <span class="toc-text">分类：</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="峻峻尼" data-src="/images/avatar.jpg"><p class="name" itemprop="name">峻峻尼</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">48</span> <span class="name">文章</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hpbnl1empq" title="https:&#x2F;&#x2F;github.com&#x2F;xinyuzjj"><i class="ic i-github"></i></span> <a href="/1105002234@qq.com" title="1105002234@qq.com" class="item email"><i class="ic i-envelope"></i></a> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMTY5ODgwNDMwP3NwbV9pZF9mcm9tPTMzMy4xMDA3LjAuMA==" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;169880430?spm_id_from&#x3D;333.1007.0.0"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>links</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2023/01/24/2022.12.15/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2023/01/24/2022.12.8/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2022/11/25/2022.11.24/" title="HCIP(九) 2022.11.24">HCIP(九) 2022.11.24</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/02/20/2023.2.13/" title="HCIA-security(一) 2023.2.13">HCIA-security(一) 2023.2.13</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/11/14/2022.11.11/" title="HCIP(一) 2022.11.11">HCIP(一) 2022.11.11</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/10/27/2022.10.27/" title="HCIA(九) 2022.10.27">HCIA(九) 2022.10.27</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/11/16/2022.11.16/" title="HCIP(四) 2022.11.16">HCIP(四) 2022.11.16</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/10/18/2022.10.17/" title="HCIA(一) 2022.10.17">HCIA(一) 2022.10.17</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/10/21/2022.10.20/" title="HCIA(四) 2022.10.20">HCIA(四) 2022.10.20</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/11/09/2022.11.4/" title="HCIA(十五）2022.11.4">HCIA(十五）2022.11.4</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/11/24/2022.11.23/" title="HCIP(八) 2022.11.23">HCIP(八) 2022.11.23</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/10/09/2022.10.9/" title="每日一记">每日一记</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">峻峻尼 @ Z.J.J</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">93k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">1:25</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2023/01/24/2022.12.16/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>